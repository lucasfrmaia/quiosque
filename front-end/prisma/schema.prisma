// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id       Int      @id @default(autoincrement())
  name     String
  email    String   @unique
  password String

  @@map("user")
}

model Produto {
  id          Int         @id @default(autoincrement())
  nome        String

  compras    ProdutoCompra[]
  notaFiscal ProdutoNotaFiscal[]

  categoriaId   Int?
  categoria   Category? @relation(fields: [categoriaId], references: [id], onDelete: SetNull)

  @@map("produto")
}

model ProdutoEstoque {
  id        Int      @id @default(autoincrement())
  preco     Float
  quantidade Int
  dataValidade DateTime
  unidade    String @default("Unidade")
  produtoId Int
  estoqueId Int

  tipo String @default("Insumo") 
  
  @@map("produto_estoque")
  @@unique([produtoId, estoqueId])
}

model ProdutoCompra {
  id         Int      @id @default(autoincrement())
  produtoId  Int
  quantidade Int
  unidade    String @default("Unidade")
  preco  Float
  data DateTime @default(now())

  produto    Produto @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@map("produto_compra")
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String @unique

  produtos Produto[]

  @@map("categoria")
}


model NotaFiscal {
  id        Int      @id @default(autoincrement())
  data      DateTime
  total     Float

  produtoId Int
  produtos   ProdutoNotaFiscal[]

  @@map("nota_fiscal")
}

model ProdutoNotaFiscal {
  id          Int      @id @default(autoincrement())
  produtoId   Int
  notaFiscalId Int
  quantidade  Int
  unidade     String @default("Unidade")
  preco       Float

  produto     Produto @relation(fields: [produtoId], references: [id], onDelete: Cascade)
  notaFiscal  NotaFiscal @relation(fields: [notaFiscalId], references: [id], onDelete: Cascade)

  @@map("produto_nota_fiscal")
  @@unique([produtoId, notaFiscalId])
}